<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>{{ page.title }} - {{ site.data.profile.navbar_name }}</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="{{ page.excerpt | strip_html | truncate: 160 }}">
    <meta name="keywords" content="{{ page.tags | join: ', ' }}">
    <meta name="author" content="{{ page.author | default: site.data.profile.primary_name }}">
    
    <!-- Open Graph -->
    <meta property="og:title" content="{{ page.title }}">
    <meta property="og:description" content="{{ page.excerpt | strip_html | truncate: 160 }}">
    <meta property="og:image" content="{{ page.cover | default: '/assets/images/blogs/default-cover.jpg' | absolute_url }}">
    <meta property="og:url" content="{{ page.url | absolute_url }}">
    <meta property="og:type" content="article">
    
    <!-- Twitter Cards -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ page.title }}">
    <meta name="twitter:description" content="{{ page.excerpt | strip_html | truncate: 160 }}">
    <meta name="twitter:image" content="{{ page.cover | default: '/assets/images/blogs/default-cover.jpg' | absolute_url }}">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css">
    <link rel="stylesheet" href="{{ '/assets/css/global.css' | relative_url }}">
    <link rel="stylesheet" href="{{ '/assets/css/blog.css' | relative_url }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
</head>
<body class="bg-light">
    {% include navbar.html %}
    
    <div class="container-lg mt-5 pt-5">
        <div class="row">
            <!-- Main Content -->
            <div class="col-lg-8">
                <article class="blog-post bg-white shadow-sm rounded-lg p-4 mb-4">
                    <!-- Article Header -->
                    <header class="mb-4">
                        <h1 class="h2 mb-3">{{ page.title }}</h1>
                        
                        <!-- Meta Information -->
                        <div class="d-flex flex-wrap align-items-center text-muted mb-3">
                            <div class="mr-3">
                                <i class="fas fa-calendar-alt"></i>
                                {{ page.date | date: "%B %d, %Y" }}
                            </div>
                            <div class="mr-3">
                                <i class="fas fa-clock"></i>
                                {{ page.reading_time | default: 5 }} min read
                            </div>
                            <div class="mr-3">
                                <i class="fas fa-user"></i>
                                {{ page.author | default: site.data.profile.primary_name }}
                            </div>
                        </div>
                        
                        <!-- Tags -->
                        {% if page.tags %}
                        <div class="mb-3">
                            {% for tag in page.tags %}
                            <span class="badge badge-primary mr-1">{{ tag }}</span>
                            {% endfor %}
                        </div>
                        {% endif %}
                        
                        <!-- Cover Image -->
                        {% if page.cover %}
                        <img src="{{ page.cover | relative_url }}" 
                             class="img-fluid rounded mb-3" 
                             alt="{{ page.title }}"
                             loading="lazy">
                        {% endif %}
                    </header>
                    
                    <!-- Article Content -->
                    <div class="blog-content">
                        {{ content }}
                    </div>
                    
                    <!-- Article Footer -->
                    <footer class="mt-4 pt-3 border-top">
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="text-muted">
                                <small>Published in {{ page.category | capitalize }}</small>
                            </div>
                            <div class="social-share">
                                <button class="btn btn-outline-primary btn-sm mr-2" onclick="shareOnTwitter()">
                                    <i class="fab fa-twitter"></i> Share
                                </button>
                                <button class="btn btn-outline-primary btn-sm" onclick="shareOnLinkedIn()">
                                    <i class="fab fa-linkedin"></i> Share
                                </button>
                            </div>
                        </div>
                    </footer>
                </article>
                
                <!-- Related Posts -->
                {% assign related_posts = site.blogs | where: "category", page.category | limit: 3 %}
                {% if related_posts.size > 0 %}
                <div class="bg-white shadow-sm rounded-lg p-4 mb-4">
                    <h4 class="mb-3">Related Posts</h4>
                    <div class="row">
                        {% for post in related_posts %}
                        <div class="col-md-4 mb-3">
                            <div class="card h-100 border-0 shadow-sm">
                                {% if post.cover %}
                                <img src="{{ post.cover | relative_url }}" class="card-img-top" alt="{{ post.title }}">
                                {% endif %}
                                <div class="card-body">
                                    <h6 class="card-title">{{ post.title }}</h6>
                                    <p class="card-text small text-muted">{{ post.excerpt | truncate: 100 }}</p>
                                    <a href="{{ post.url }}" class="btn btn-sm btn-outline-primary">Read More</a>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
                
                <!-- Comments -->
                <div class="bg-white shadow-sm rounded-lg p-4">
                    <h4 class="mb-3">
                        <i class="fas fa-comments"></i> Comments
                    </h4>
                    <div id="gitalk-container"></div>
                </div>
            </div>
            
            <!-- Sidebar -->
            <div class="col-lg-4">
                {% include widgets/blog_sidebar.html %}
            </div>
        </div>
    </div>
    
    {% include footer.html %}

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="{{ '/assets/js/common.js' | relative_url }}"></script>
    <script src="{{ '/assets/js/blog.js' | relative_url }}"></script>
    <script src="{{ '/assets/js/blog_views.js' | relative_url }}"></script>
    
    <!-- Gitalk -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
    <script>
        var gitalk = new Gitalk({
            clientID: '{{ site.data.profile.gitalk_client_id | default: "your-github-app-client-id" }}',
            clientSecret: '{{ site.data.profile.gitalk_client_secret | default: "your-github-app-client-secret" }}',
            repo: '{{ site.data.profile.gitalk_repo | default: "ruixizhang0906.github.io" }}',
            owner: '{{ site.data.profile.gitalk_owner | default: "ruixizhang0906" }}',
            admin: ['{{ site.data.profile.gitalk_admin | default: "ruixizhang0906" }}'],
            id: window.location.pathname,
            distractionFreeMode: false,
            language: 'en'
        });
        gitalk.render('gitalk-container');
    </script>
    
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            if (typeof renderMathInElement === 'function') {
                renderMathInElement(document.body, {
                  delimiters: [
                      {left: '$$', right: '$$', display: true},
                      {left: '$', right: '$', display: false},
                      {left: '\\(', right: '\\)', display: false},
                      {left: '\\[', right: '\\]', display: true}
                  ],
                  throwOnError : false
                });
            }
        });
    </script>
    
    <script>
        // Social sharing functions
        function shareOnTwitter() {
            const url = encodeURIComponent(window.location.href);
            const text = encodeURIComponent('{{ page.title }}');
            window.open(`https://twitter.com/intent/tweet?url=${url}&text=${text}`, '_blank');
        }
        
        function shareOnLinkedIn() {
            const url = encodeURIComponent(window.location.href);
            const title = encodeURIComponent('{{ page.title }}');
            const summary = encodeURIComponent('{{ page.excerpt | strip_html | truncate: 200 }}');
            window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${url}`, '_blank');
        }
    </script>
</body>
</html>
